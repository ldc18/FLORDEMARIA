{"ast":null,"code":"import { take } from 'rxjs/operators';\nimport { FormControl } from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\nimport * as fromRoot from '../../../store/reducers';\nimport * as actions from '../../../store/actions';\nimport { languages } from '../../../shared/constants';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/material/form-field\";\nimport * as i4 from \"@angular/material/input\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/common\";\n\nfunction TranslationsEditComponent_div_16_ng_container_4_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function TranslationsEditComponent_div_16_ng_container_4_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const sentence_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.removeTranslation(sentence_r4.key);\n    });\n    i0.ɵɵtext(1, \" - \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction TranslationsEditComponent_div_16_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 9);\n    i0.ɵɵtemplate(2, TranslationsEditComponent_div_16_ng_container_4_button_2_Template, 2, 0, \"button\", 10);\n    i0.ɵɵelementStart(3, \"mat-form-field\", 3)(4, \"mat-label\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"input\", 11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const sentence_r4 = ctx.$implicit;\n    const i_r2 = i0.ɵɵnextContext().index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !i_r2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(sentence_r4.key);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControlName\", sentence_r4.key);\n  }\n}\n\nfunction TranslationsEditComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 1)(2, \"h1\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, TranslationsEditComponent_div_16_ng_container_4_Template, 7, 3, \"ng-container\", 7);\n    i0.ɵɵpipe(5, \"keyvalue\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-form-field\")(7, \"mat-label\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"textarea\", 8);\n    i0.ɵɵtext(10, \"          \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(11, \"br\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const translation_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.languageForm.controls[translation_r1.lang]);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(translation_r1.lang);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(5, 5, translation_r1.keys));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", translation_r1.lang, \" JSON\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControlName\", translation_r1.lang + \"_json\");\n  }\n}\n\nexport let TranslationsEditComponent = /*#__PURE__*/(() => {\n  class TranslationsEditComponent {\n    constructor(store, fb) {\n      this.store = store;\n      this.fb = fb;\n      this.translationSub$ = new BehaviorSubject([]);\n      this.allLanguages = languages;\n      this.store.dispatch(new actions.GetAllTranslations());\n      this.languageForm = this.fb.group({\n        add: ''\n      });\n      this.translations$ = this.store.select(fromRoot.getAllTranslations);\n      this.translationsSub = this.translations$.subscribe(translations => {\n        translations.forEach(translation => {\n          const keys = translation.keys;\n          const newUsergroup = this.fb.group({});\n          Object.keys(keys).map(key => {\n            newUsergroup.addControl(key, new FormControl(keys[key]));\n          });\n          this.languageForm.setControl(translation.lang, newUsergroup);\n          this.languageForm.setControl(translation.lang + '_json', new FormControl(JSON.stringify(keys)));\n        });\n        this.translationSub$.next(translations);\n      });\n    }\n\n    addKeyToTranslation() {\n      const newKey = this.languageForm.get('add').value;\n\n      if (newKey) {\n        this.translationSub$.pipe(take(1)).subscribe(translations => {\n          const updateTransations = translations.map(translation => {\n            const langGroup = this.languageForm.get(translation.lang);\n            langGroup.addControl(newKey, new FormControl(newKey));\n            return { ...translation,\n              keys: { ...translation.keys,\n                [newKey]: newKey\n              }\n            };\n          });\n          this.translationSub$.next(updateTransations);\n        });\n        this.languageForm.get('add').patchValue('');\n      }\n    }\n\n    removeTranslation(toRemove) {\n      this.translationSub$.pipe(take(1)).subscribe(translations => {\n        const updateTransations = translations.map(translation => {\n          const langGroup = this.languageForm.get(translation.lang);\n          langGroup.removeControl(toRemove);\n          return { ...translation,\n            keys: Object.keys(translation.keys).filter(key => key !== toRemove).reduce((prev, curr) => ({ ...prev,\n              [curr]: translation.keys[curr]\n            }), {})\n          };\n        });\n        this.translationSub$.next(updateTransations);\n      });\n    }\n\n    submitForm() {\n      const allTranslations = Object.keys(this.languageForm.value).filter(value => this.allLanguages.includes(value)).map(lang => ({\n        lang,\n        keys: this.languageForm.value[lang]\n      }));\n      this.store.dispatch(new actions.EditTranslation(allTranslations));\n    }\n\n    submitJSON() {\n      const allTranslations = Object.keys(this.languageForm.value).filter(value => value.includes('_json')).map(lang => ({\n        lang: lang.replace('_json', ''),\n        keys: JSON.parse(this.languageForm.value[lang])\n      }));\n      this.store.dispatch(new actions.EditTranslation(allTranslations));\n    }\n\n    ngOnDestroy() {\n      this.translationsSub.unsubscribe();\n    }\n\n  }\n\n  TranslationsEditComponent.ɵfac = function TranslationsEditComponent_Factory(t) {\n    return new (t || TranslationsEditComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.FormBuilder));\n  };\n\n  TranslationsEditComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TranslationsEditComponent,\n    selectors: [[\"app-translations-edit\"]],\n    decls: 18,\n    vars: 6,\n    consts: [[1, \"translations_edit-wrapper\"], [3, \"formGroup\"], [1, \"translations-subform\"], [1, \"product_edit-field\"], [\"matInput\", \"\", \"formControlName\", \"add\"], [\"mat-flat-button\", \"\", \"color\", \"accent\", 1, \"translations-button\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 1, \"translations-button\", 3, \"disabled\", \"click\"], [4, \"ngFor\", \"ngForOf\"], [\"matInput\", \"\", 1, \"translation-textarea\", 3, \"formControlName\"], [1, \"translation-sentence\"], [\"class\", \"translations-button\", \"mat-mini-fab\", \"\", \"color\", \"accent\", 3, \"click\", 4, \"ngIf\"], [\"matInput\", \"\", 3, \"formControlName\"], [\"mat-mini-fab\", \"\", \"color\", \"accent\", 1, \"translations-button\", 3, \"click\"]],\n    template: function TranslationsEditComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1)(2, \"div\", 2)(3, \"div\")(4, \"mat-form-field\", 3)(5, \"mat-label\");\n        i0.ɵɵtext(6, \"Add key\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"input\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 5);\n        i0.ɵɵlistener(\"click\", function TranslationsEditComponent_Template_button_click_8_listener() {\n          return ctx.addKeyToTranslation();\n        });\n        i0.ɵɵtext(9, \" + \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"div\")(11, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function TranslationsEditComponent_Template_button_click_11_listener() {\n          return ctx.submitForm();\n        });\n        i0.ɵɵtext(12, \" Save from inputs \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function TranslationsEditComponent_Template_button_click_13_listener() {\n          return ctx.submitJSON();\n        });\n        i0.ɵɵtext(14, \" Save from JSONS \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(15, \"div\", 2);\n        i0.ɵɵtemplate(16, TranslationsEditComponent_div_16_Template, 12, 7, \"div\", 7);\n        i0.ɵɵpipe(17, \"async\");\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.languageForm);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"disabled\", ctx.languageForm.invalid);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"disabled\", ctx.languageForm.invalid);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(17, 4, ctx.translationSub$));\n      }\n    },\n    directives: [i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i3.MatFormField, i3.MatLabel, i4.MatInput, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName, i5.MatButton, i6.NgForOf, i6.NgIf],\n    pipes: [i6.AsyncPipe, i6.KeyValuePipe],\n    styles: [\"[_nghost-%COMP%]{display:flex;min-height:100vh;flex-direction:column}[_nghost-%COMP%]   .translations-subform[_ngcontent-%COMP%]{display:flex;width:100%;flex-wrap:wrap;justify-content:space-between}[_nghost-%COMP%]   .translations-button[_ngcontent-%COMP%]{margin:0 10px}[_nghost-%COMP%]   .translations_edit-wrapper[_ngcontent-%COMP%]{background:#fff;padding:20px}[_nghost-%COMP%]   .translation-sentence[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .translation-textarea[_ngcontent-%COMP%]{min-height:400px}\"]\n  });\n  return TranslationsEditComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}
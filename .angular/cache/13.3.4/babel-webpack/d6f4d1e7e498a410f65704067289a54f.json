{"ast":null,"code":"import _asyncToGenerator from \"/home/ejcalderon/Escritorio/TALLER/PROYECTO N2/CODE/eshop_mean-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventEmitter, PLATFORM_ID } from '@angular/core';\nimport { isPlatformServer, DOCUMENT } from '@angular/common';\nimport { take } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../services/env-configuration.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/material/button\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/progress-bar\";\nimport * as i6 from \"../../../pipes/translate.pipe\";\nconst _c0 = [\"cardElement\"];\n\nfunction CardComponent_mat_progress_bar_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 9);\n  }\n}\n\nfunction CardComponent_div_18_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const cardError_r4 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(cardError_r4);\n  }\n}\n\nfunction CardComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵtemplate(1, CardComponent_div_18_span_1_Template, 2, 1, \"span\", 11);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const cardError_r4 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", cardError_r4 !== \"INVALID\");\n  }\n}\n\nexport let CardComponent = /*#__PURE__*/(() => {\n  class CardComponent {\n    constructor(envConfigurationService, _document, _platformId) {\n      this.envConfigurationService = envConfigurationService;\n      this._document = _document;\n      this._platformId = _platformId;\n      this.scrollToTop = new EventEmitter();\n      this.payWithCardEmit = new EventEmitter();\n      this.cardErrorSub$ = new BehaviorSubject('INVALID');\n      this.loadingPayment = false;\n    }\n\n    ngOnInit() {\n      if (!isPlatformServer(this._platformId) && typeof Stripe !== 'object') {\n        const parentElement = this._document.querySelector('head');\n\n        const scriptEl = this._document.createElement('script');\n\n        scriptEl.setAttribute('type', 'text/javascript');\n        scriptEl.setAttribute('src', 'https://js.stripe.com/v3/');\n        parentElement.appendChild(scriptEl);\n\n        scriptEl.onload = event => {\n          this._setHandler();\n        };\n      } else if (typeof Stripe === 'object') {\n        this._setHandler();\n      }\n    }\n\n    handleForm(e) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        e.preventDefault();\n        _this.loadingPayment = true;\n\n        _this.stripe.createToken(_this.card).then(result => {\n          if (result.error) {\n            _this.cardErrorSub$.next(result.error.message);\n\n            _this.loadingPayment = false;\n          } else {\n            _this.cardErrorSub$.next('');\n\n            _this.stripeTokenHandler(result.token);\n\n            _this.scrollToTop.emit();\n\n            _this.loadingPayment = false;\n          }\n        });\n      })();\n    }\n\n    stripeTokenHandler(token) {\n      const payment = {\n        token: token,\n        amount: this.price,\n        currency: this.currency\n      };\n      this.payWithCardEmit.emit(payment);\n    }\n\n    _setHandler() {\n      this.envConfigurationService.getConfigType$('FE_STRIPE_PUBLISHABLE_KEY').pipe(take(1)).subscribe(stripePublishableKey => {\n        this.stripe = Stripe(stripePublishableKey);\n        const elements = this.stripe.elements();\n        this.card = elements.create('card');\n        this.card.mount(this.cardElement.nativeElement);\n        this.card.addEventListener('change', ({\n          error,\n          complete\n        }) => {\n          const cardError = error && error.message ? error.message : complete ? '' : 'INVALID';\n          this.cardErrorSub$.next(cardError);\n        });\n      });\n    }\n\n  }\n\n  CardComponent.ɵfac = function CardComponent_Factory(t) {\n    return new (t || CardComponent)(i0.ɵɵdirectiveInject(i1.EnvConfigurationService), i0.ɵɵdirectiveInject(DOCUMENT), i0.ɵɵdirectiveInject(PLATFORM_ID));\n  };\n\n  CardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CardComponent,\n    selectors: [[\"app-card\"]],\n    viewQuery: function CardComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.cardElement = _t.first);\n      }\n    },\n    inputs: {\n      price: \"price\",\n      currency: \"currency\",\n      loading: \"loading\"\n    },\n    outputs: {\n      scrollToTop: \"scrollToTop\",\n      payWithCardEmit: \"payWithCardEmit\"\n    },\n    decls: 20,\n    vars: 24,\n    consts: [[1, \"checkout\", 3, \"submit\"], [\"paymentForm\", \"\"], [\"for\", \"card-info\"], [\"id\", \"form-field\"], [\"id\", \"card-info\"], [\"cardElement\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"id\", \"submit-button\", \"type\", \"submit\", 1, \"card-button\", 3, \"disabled\"], [\"mode\", \"indeterminate\", 4, \"ngIf\"], [\"class\", \"card-errors\", \"id\", \"card-errors\", \"role\", \"alert\", 4, \"ngIf\"], [\"mode\", \"indeterminate\"], [\"id\", \"card-errors\", \"role\", \"alert\", 1, \"card-errors\"], [4, \"ngIf\"]],\n    template: function CardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\")(1, \"form\", 0, 1);\n        i0.ɵɵlistener(\"submit\", function CardComponent_Template_form_submit_1_listener($event) {\n          return ctx.handleForm($event);\n        });\n        i0.ɵɵelementStart(3, \"label\", 2);\n        i0.ɵɵtext(4, \"Card\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵelement(6, \"div\", 4, 5);\n        i0.ɵɵelementStart(8, \"button\", 6);\n        i0.ɵɵpipe(9, \"async\");\n        i0.ɵɵtext(10);\n        i0.ɵɵpipe(11, \"async\");\n        i0.ɵɵpipe(12, \"translate\");\n        i0.ɵɵpipe(13, \"async\");\n        i0.ɵɵpipe(14, \"translate\");\n        i0.ɵɵpipe(15, \"async\");\n        i0.ɵɵpipe(16, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(17, CardComponent_mat_progress_bar_17_Template, 1, 0, \"mat-progress-bar\", 7);\n        i0.ɵɵtemplate(18, CardComponent_div_18_Template, 2, 1, \"div\", 8);\n        i0.ɵɵpipe(19, \"async\");\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"disabled\", !!i0.ɵɵpipeBind1(9, 8, ctx.cardErrorSub$) && !ctx.loading || ctx.loadingPayment);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate5(\" \", i0.ɵɵpipeBind1(11, 10, i0.ɵɵpipeBind1(12, 12, \"MakeOrder\")), \" \", i0.ɵɵpipeBind1(13, 14, i0.ɵɵpipeBind1(14, 16, \"and\")), \" \", i0.ɵɵpipeBind1(15, 18, i0.ɵɵpipeBind1(16, 20, \"Pay\")), \" \", ctx.price, \" \", ctx.currency, \" \");\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(19, 22, ctx.cardErrorSub$));\n      }\n    },\n    directives: [i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.NgForm, i3.MatButton, i4.NgIf, i5.MatProgressBar],\n    pipes: [i4.AsyncPipe, i6.TranslatePipe],\n    styles: [\"[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]   .StripeElement[_ngcontent-%COMP%]{box-sizing:border-box;height:40px;padding:10px 12px;border:1px solid rgba(0,0,0,.1);border-radius:4px;background-color:#fff;box-shadow:0 1px 3px #e6ebf1;transition:box-shadow .15s ease}[_nghost-%COMP%]   .card-button[_ngcontent-%COMP%]{margin:10px 0;width:100%}[_nghost-%COMP%]   .card-errors[_ngcontent-%COMP%]{color:#fa755a}[_nghost-%COMP%]   .StripeElement--focus[_ngcontent-%COMP%]{box-shadow:0 1px 3px #cfd7df}[_nghost-%COMP%]   .StripeElement--invalid[_ngcontent-%COMP%]{border-color:#fa755a}[_nghost-%COMP%]   .StripeElement--webkit-autofill[_ngcontent-%COMP%]{background-color:#fefde5!important}\"]\n  });\n  return CardComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}
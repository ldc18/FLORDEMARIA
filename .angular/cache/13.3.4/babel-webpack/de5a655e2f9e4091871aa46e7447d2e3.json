{"ast":null,"code":"import { filter, map, take, distinctUntilChanged, skip, withLatestFrom } from 'rxjs/operators';\nimport { combineLatest } from 'rxjs';\nimport * as actions from '../../../store/actions';\nimport * as fromRoot from '../../../store/reducers';\nimport { ImagesDialogComponent } from '../../../shared/images-dialog/images-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@ngrx/store\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/platform-browser\";\nimport * as i5 from \"@angular/material/dialog\";\nimport * as i6 from \"@angular/material/snack-bar\";\nimport * as i7 from \"../../../services/translate.service\";\nimport * as i8 from \"./../../../services/jsonLD.service\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@angular/material/progress-bar\";\nimport * as i11 from \"@angular/material/card\";\nimport * as i12 from \"../../../shared/product-content/product-content.component\";\nimport * as i13 from \"@angular/material/tabs\";\nimport * as i14 from \"../../../utils/lazyLoadImg/lazy-src.directive\";\nimport * as i15 from \"../../../pipes/translate.pipe\";\n\nfunction ProductComponent_mat_progress_bar_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 6);\n  }\n}\n\nfunction ProductComponent_ng_container_11_mat_card_1_ng_container_1_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵlistener(\"click\", function ProductComponent_ng_container_11_mat_card_1_ng_container_1_div_16_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const i_r8 = restoredCtx.index;\n      const product_r4 = i0.ɵɵnextContext(2).ngIf;\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return ctx_r11.openDialog(i_r8, product_r4 == null ? null : product_r4.images);\n    });\n    i0.ɵɵelement(1, \"img\", 16);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const imageSrc_r7 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"lazySrc\", imageSrc_r7);\n  }\n}\n\nfunction ProductComponent_ng_container_11_mat_card_1_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"app-product-content\", 9);\n    i0.ɵɵlistener(\"addProduct\", function ProductComponent_ng_container_11_mat_card_1_ng_container_1_Template_app_product_content_addProduct_1_listener($event) {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext(3);\n      return ctx_r14.cartEvent($event, \"add\");\n    })(\"removeProduct\", function ProductComponent_ng_container_11_mat_card_1_ng_container_1_Template_app_product_content_removeProduct_1_listener($event) {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r16 = i0.ɵɵnextContext(3);\n      return ctx_r16.cartEvent($event, \"remove\");\n    });\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵpipe(4, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-tab-group\")(6, \"mat-tab\", 10);\n    i0.ɵɵpipe(7, \"async\");\n    i0.ɵɵpipe(8, \"translate\");\n    i0.ɵɵelementStart(9, \"mat-card-content\", 11);\n    i0.ɵɵelement(10, \"div\", 12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"mat-tab\", 10);\n    i0.ɵɵpipe(12, \"async\");\n    i0.ɵɵpipe(13, \"translate\");\n    i0.ɵɵelementStart(14, \"mat-card-content\", 11)(15, \"div\", 13);\n    i0.ɵɵtemplate(16, ProductComponent_ng_container_11_mat_card_1_ng_container_1_div_16_Template, 2, 1, \"div\", 14);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const product_r4 = i0.ɵɵnextContext().ngIf;\n    const items_r2 = i0.ɵɵnextContext().ngIf;\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"product\", product_r4)(\"categories\", i0.ɵɵpipeBind1(2, 9, ctx_r5.categories$))(\"cartIds\", items_r2 == null ? null : items_r2.cartIds)(\"currency\", i0.ɵɵpipeBind1(3, 11, ctx_r5.currency$))(\"lang\", i0.ɵɵpipeBind1(4, 13, ctx_r5.lang$));\n    i0.ɵɵadvance(5);\n    i0.ɵɵpropertyInterpolate(\"label\", i0.ɵɵpipeBind1(7, 15, i0.ɵɵpipeBind1(8, 17, \"Descripcion\")));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"innerHTML\", product_r4 == null ? null : product_r4.descriptionFull, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"label\", i0.ɵɵpipeBind1(12, 19, i0.ɵɵpipeBind1(13, 21, \"Imagenes\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", product_r4 == null ? null : product_r4.images);\n  }\n}\n\nfunction ProductComponent_ng_container_11_mat_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 8);\n    i0.ɵɵtemplate(1, ProductComponent_ng_container_11_mat_card_1_ng_container_1_Template, 17, 23, \"ng-container\", 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const product_r4 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", product_r4.visibility && product_r4.salePrice);\n  }\n}\n\nfunction ProductComponent_ng_container_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, ProductComponent_ng_container_11_mat_card_1_Template, 2, 1, \"mat-card\", 7);\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const items_r2 = ctx.ngIf;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !i0.ɵɵpipeBind1(2, 1, ctx_r1.productLoading$) && items_r2.product);\n  }\n}\n\nexport let ProductComponent = /*#__PURE__*/(() => {\n  class ProductComponent {\n    constructor(route, store, location, meta, title, dialog, snackBar, router, translate, jsonLDService) {\n      this.route = route;\n      this.store = store;\n      this.location = location;\n      this.meta = meta;\n      this.title = title;\n      this.dialog = dialog;\n      this.snackBar = snackBar;\n      this.router = router;\n      this.translate = translate;\n      this.jsonLDService = jsonLDService;\n      this.lang$ = this.translate.getLang$();\n      this.categories$ = this.store.select(fromRoot.getCategories);\n      this.routeSub = combineLatest([this.lang$, this.route.params.pipe(map(params => params['id']))]).subscribe(([lang, id]) => {\n        this.store.dispatch(new actions.GetProduct(id + '?lang=' + lang));\n      });\n      this.currency$ = this.store.select(fromRoot.getCurrency);\n      this.callCategories();\n      this.setMetaData();\n      this.productLoading$ = this.store.select(fromRoot.getProductLoading);\n      this.items$ = combineLatest([this.store.select(fromRoot.getProduct), this.store.select(fromRoot.getCart).pipe(filter(Boolean), map(cart => cart.items))]).pipe(map(([product, cartItems]) => ({\n        product,\n        cartIds: cartItems.reduce((prev, curr) => ({ ...prev,\n          [curr.id]: curr.qty\n        }), {})\n      })));\n    }\n\n    cartEvent(id, type) {\n      if (type === 'add') {\n        this.store.dispatch(new actions.AddToCart('?id=' + id));\n        this.translate.getTranslations$().pipe(map(translations => translations ? {\n          message: translations['ADDED_TO_CART'] || 'Agredado a la cesta',\n          action: translations['TO_CART'] || 'Ir a la cesta'\n        } : {\n          message: 'Agredado a la cesta',\n          action: 'To Cart'\n        }), take(1)).subscribe(({\n          message,\n          action\n        }) => {\n          let snackBarRef = this.snackBar.open(message, action, {\n            duration: 3000\n          });\n          snackBarRef.onAction().pipe(withLatestFrom(this.lang$), take(1)).subscribe(([_, lang]) => {\n            this.router.navigate(['/' + lang + '/cart']);\n          });\n        });\n      }\n\n      if (type === 'remove') {\n        this.store.dispatch(new actions.RemoveFromCart('?id=' + id));\n      }\n    }\n\n    goBack() {\n      this.location.back();\n    }\n\n    openDialog(index, images) {\n      const dialogRef = this.dialog.open(ImagesDialogComponent, {\n        width: '100vw',\n        maxHeight: '100vh',\n        data: {\n          index,\n          images\n        }\n      });\n      dialogRef.afterClosed().subscribe(result => {\n        console.log('The dialog was closed');\n      });\n    }\n\n    ngOnDestroy() {\n      this.routeSub.unsubscribe();\n      this.categoriesSub.unsubscribe();\n    }\n\n    callCategories() {\n      combineLatest([this.categories$.pipe(take(1)), this.lang$.pipe(take(1))]).pipe(take(1)).subscribe(([categories, lang]) => {\n        if (!categories.length) {\n          this.store.dispatch(new actions.GetCategories(lang));\n        }\n      });\n      this.categoriesSub = this.lang$.pipe(distinctUntilChanged(), skip(1)).subscribe(lang => {\n        this.store.dispatch(new actions.GetCategories(lang));\n      });\n    }\n\n    setMetaData() {\n      this.store.select(fromRoot.getProduct).pipe(filter(product => !!product && !!product.title), withLatestFrom(this.currency$), take(1)).subscribe(([product, currency]) => {\n        var _a;\n\n        this.title.setTitle(product.title);\n        this.meta.updateTag({\n          name: 'description',\n          content: product.description\n        });\n        const productSchema = {\n          \"@context\": \"https://schema.org/\",\n          \"@type\": \"Product\",\n          \"name\": product.title,\n          \"image\": (_a = product.mainImage) === null || _a === void 0 ? void 0 : _a.url,\n          \"offers\": {\n            \"@type\": \"Offer\",\n            \"priceCurrency\": currency,\n            \"price\": product.regularPrice,\n            \"availability\": product.stock === 'onStock' ? \"https://schema.org/InStock\" : 'https://schema.org/OutOfStock'\n          },\n          \"description\": product.description\n        };\n        this.jsonLDService.insertSchema(productSchema, 'structured-data-product');\n      });\n    }\n\n  }\n\n  ProductComponent.ɵfac = function ProductComponent_Factory(t) {\n    return new (t || ProductComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Store), i0.ɵɵdirectiveInject(i3.Location), i0.ɵɵdirectiveInject(i4.Meta), i0.ɵɵdirectiveInject(i4.Title), i0.ɵɵdirectiveInject(i5.MatDialog), i0.ɵɵdirectiveInject(i6.MatSnackBar), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i7.TranslateService), i0.ɵɵdirectiveInject(i8.JsonLDService));\n  };\n\n  ProductComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ProductComponent,\n    selectors: [[\"app-product\"]],\n    decls: 13,\n    vars: 13,\n    consts: [[1, \"main\"], [1, \"container\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"material-icons\", \"left\"], [\"mode\", \"indeterminate\", 4, \"ngIf\"], [4, \"ngIf\"], [\"mode\", \"indeterminate\"], [\"class\", \"product\", 4, \"ngIf\"], [1, \"product\"], [3, \"product\", \"categories\", \"cartIds\", \"currency\", \"lang\", \"addProduct\", \"removeProduct\"], [3, \"label\"], [1, \"product-tab-content\"], [3, \"innerHTML\"], [1, \"product-images\"], [\"class\", \"product-images-content\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"product-images-content\", 3, \"click\"], [\"lazySrcVisible\", \"visible\", 1, \"product-images-image\", 3, \"lazySrc\"]],\n    template: function ProductComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n        i0.ɵɵlistener(\"click\", function ProductComponent_Template_button_click_2_listener() {\n          return ctx.goBack();\n        });\n        i0.ɵɵelementStart(3, \"i\", 3);\n        i0.ɵɵtext(4, \"arrow_back\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(5);\n        i0.ɵɵpipe(6, \"async\");\n        i0.ɵɵpipe(7, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(8, ProductComponent_mat_progress_bar_8_Template, 1, 0, \"mat-progress-bar\", 4);\n        i0.ɵɵpipe(9, \"async\");\n        i0.ɵɵpipe(10, \"async\");\n        i0.ɵɵtemplate(11, ProductComponent_ng_container_11_Template, 3, 3, \"ng-container\", 5);\n        i0.ɵɵpipe(12, \"async\");\n        i0.ɵɵelementEnd()();\n      }\n\n      if (rf & 2) {\n        let tmp_1_0;\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(6, 3, i0.ɵɵpipeBind1(7, 5, \"Atras\")), \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", !((tmp_1_0 = i0.ɵɵpipeBind1(9, 7, ctx.items$)) == null ? null : tmp_1_0.product) || i0.ɵɵpipeBind1(10, 9, ctx.productLoading$));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(12, 11, ctx.items$));\n      }\n    },\n    directives: [i9.MatButton, i3.NgIf, i10.MatProgressBar, i11.MatCard, i12.ProductContentComponent, i13.MatTabGroup, i13.MatTab, i11.MatCardContent, i3.NgForOf, i14.LazySrcDirective],\n    pipes: [i3.AsyncPipe, i15.TranslatePipe],\n    styles: [\"[_nghost-%COMP%]{display:flex;min-height:100vh;flex-direction:column}[_nghost-%COMP%]   .product[_ngcontent-%COMP%]{margin-top:10px;box-shadow:0 2px 2px #00000024,0 3px 1px -2px #0000001f,0 1px 5px #0003}[_nghost-%COMP%]   .product-images[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:0 4px}[_nghost-%COMP%]   .product-images-content[_ngcontent-%COMP%]{flex:25%;max-width:25%;padding:0 4px;position:relative;cursor:pointer}@media screen and (max-width: 800px){[_nghost-%COMP%]   .product-images-content[_ngcontent-%COMP%]{flex:50%;max-width:50%}}@media screen and (max-width: 600px){[_nghost-%COMP%]   .product-images-content[_ngcontent-%COMP%]{flex:100%;max-width:100%}}[_nghost-%COMP%]   .product-images-image[_ngcontent-%COMP%]{margin-top:8px;display:block;max-width:100%}\"]\n  });\n  return ProductComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}